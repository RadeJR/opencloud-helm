# OpenCloud Helm Chart Values
# This is a YAML-formatted file with configuration values for the OpenCloud Helm chart.
# The file is organized into logical sections for different components of the system.

# =====================================================================
# SECURITY WARNING
# =====================================================================
# IMPORTANT: By default, passwords are randomly generated for better security.
# If you need to set specific passwords, you can provide them via values or existing secrets.
#
# Default behavior (recommended):
# - Keycloak Admin: Random 24-character password (retrieve: kubectl get secret <release>-opencloud-keycloak -o jsonpath='{.data.adminPassword}' | base64 -d)
# - PostgreSQL: Random 24-character password (retrieve: kubectl get secret <release>-opencloud-postgres -o jsonpath='{.data.password}' | base64 -d)
# - MinIO: Random 24-character password (retrieve: kubectl get secret <release>-opencloud-minio -o jsonpath='{.data.rootPassword}' | base64 -d)
# - OpenCloud Built-in IDP Admin: Random 24-character password (retrieve: kubectl get secret <release>-opencloud-opencloud -o jsonpath='{.data.adminPassword}' | base64 -d)
# - Collabora: Random 24-character password (retrieve: kubectl get secret <release>-opencloud-collabora -o jsonpath='{.data.password}' | base64 -d)
#
# To set specific passwords:
# 1. Keycloak Admin: identityProvider.keycloak.adminPassword (leave empty for random)
# 2. OpenCloud Built-in IDP Admin: identityProvider.internal.adminPassword (leave empty for random)
# 3. PostgreSQL: identityProvider.keycloak.postgres.password (leave empty for random)
# 4. MinIO: storage.internal.rootPassword (leave empty for random)
# 5. Collabora: collabora.admin.password (leave empty for random)
# 6. RabbitMQ: url: amqp://guest:guest@localhost (TODO: add random password support)


# =====================================================================
# GLOBAL SETTINGS
# =====================================================================

# Global settings that apply across components
global:
  # Domain settings for various services
  domain:
    # Main domain for OpenCloud
    opencloud: cloud.opencloud.test
    # Domain for Keycloak
    keycloak: keycloak.opencloud.test
    # Domain for MinIO
    minio: minio.opencloud.test
    # Domain for Collabora CODE
    collabora: collabora.opencloud.test
    # Domain for WOPI (collaboration service)
    wopi: wopi.opencloud.test


  # TLS settings for secure connections
  tls:
    # Enable TLS (set to false when using gateway TLS termination externally)
    enabled: false
    # secretName for TLS certificate
    secretName: ""

  # Global storage settings
  storage:
    # Storage class for persistent volumes
    storageClass: ""

  # Global image settings
  image:
    # Global registry override - if set, it will override all image registries
    # Example: my-private-registry.com
    registry: ""
    # Global pull policy override - if set, it will override all image pull policies
    # Options: Always, IfNotPresent, Never
    pullPolicy: ""

  # Global ingress defaults (can be overridden per service)
  ingress:
    # Default ingress class name (e.g., nginx, traefik)
    # Leave empty to use the cluster default
    ingressClassName: ""

    # Default annotations preset for common ingress controllers
    # Supported values: nginx, nginx-no-snippets, traefik, haproxy, contour, istio, ""
    # These add controller-specific annotations (e.g., for X-Forwarded-Proto header)
    annotationsPreset: ""

    # Default custom annotations for all ingress resources
    # Can be overridden per service
    annotations: {}
      # Example:
      # cert-manager.io/cluster-issuer: letsencrypt

    # Default TLS secret name for all ingress resources
    # When a service enables TLS (ingress.tls.enabled=true):
    # - If service specifies tls.secretName: use that value
    # - Else if global tls.secretName is set: use the global value
    # - Else: auto-generate a secret name like "<release-name>-<service>-tls"
    tls:
      # Default TLS secret name shared by all ingresses when TLS is enabled
      # Leave empty to auto-generate per-service secret names
      # Set to share the same secret across all services (useful for wildcard certs)
      secretName: ""

# =====================================================================
# IDENTITY PROVIDER
# =====================================================================

# Identity Provider configuration
# OpenCloud has a built-in identity provider, but you can also use Keycloak or external OIDC
# Choose ONE provider:
#   1. keycloak - Deploy Keycloak instance managed by this chart
#   2. external - Connect to external OIDC provider (Auth0, Okta, Azure AD, Google, etc.)
#   3. (none/both disabled) - Use OpenCloud's built-in identity provider
# If both keycloak and external are enabled, external OIDC takes precedence
identityProvider:
  # Keycloak deployment
  # Deploy and manage a Keycloak instance for authentication
  keycloak:
    # Enable Keycloak deployment
    enabled: true
    
    # Keycloak image settings
    image:
      # Keycloak image registry
      registry: quay.io
      # Keycloak image repository
      repository: keycloak/keycloak
      # Keycloak image tag
      tag: "26.1.4"
      # Image pull policy
      pullPolicy: IfNotPresent
    
    # Number of Keycloak replicas
    replicas: 1

    # Use existing secret for keycloak credentials (Note: secretKeyName must be adminUser and adminPassword)
    existingSecret: ""

    # Admin user
    # ignored if identityProvider.keycloak.existingSecret is set
    adminUser: admin

    # Admin password
    # ignored if identityProvider.keycloak.existingSecret is set
    # Leave empty to generate a random password
    adminPassword: ""

    # Keycloak realm
    realm: "openCloud"

    # CORS settings for cross-origin requests
    cors:
      # Enable CORS
      enabled: true
      # Allow all origins
      allowAllOrigins: true
      # Allowed origins (used if allowAllOrigins is false)
      origins: []
      # Allowed methods
      methods: "GET,POST,PUT,DELETE,OPTIONS"
      # Allowed headers
      headers: "Origin,Accept,Authorization,Content-Type,Cache-Control"
      # Exposed headers
      exposedHeaders: "Access-Control-Allow-Origin,Access-Control-Allow-Credentials"
      # Allow credentials
      allowCredentials: "true"
      # Max age in seconds
      maxAge: "3600"
    
    # Resources
    resources: {}
  
    # Ingress configuration for Keycloak
    ingress:
      # Enable ingress for Keycloak
      enabled: false
      # Ingress class name (inherits from global ingress.ingressClassName if empty)
      ingressClassName: ""
      # Annotations preset (inherits from global ingress.annotationsPreset if empty)
      annotationsPreset: ""
      # Custom annotations (merged with global ingress.annotations)
      annotations: {}
      # TLS configuration
      tls:
        # Enable TLS (inherits from global ingress.tls.enabled if not set)
        enabled: false
        # TLS secret name (inherits from global ingress.tls.secretName if empty)
        secretName: ""
    
    # PostgreSQL database for Keycloak
    postgres:
      # Enable PostgreSQL deployment
      # Automatically enabled when identityProvider.keycloak.enabled is true
      enabled: true
      
      # PostgreSQL image settings
      image:
        # PostgreSQL image registry
        registry: docker.io
        # PostgreSQL image repository
        repository: postgres
        # PostgreSQL image tag
        tag: "alpine"
        # Image pull policy
        pullPolicy: IfNotPresent

      # Database name
      database: keycloak

      # Use existing secret for postgres credentials (Note: secretKeyName must be username and password)
      existingSecret: ""

      # Database user
      # ignored if postgres.existingSecret is set
      user: keycloak

      # Database password
      # ignored if postgres.existingSecret is set
      # Leave empty to generate a random password
      password: ""

      # Resources allocation
      # Resources allocation for PostgreSQL
      resources: {}
        # Example:
        # requests:
        #   cpu: 100m
        #   memory: 128Mi
        # limits:
        #   cpu: 500m
        #   memory: 512Mi
      
      # Persistence configuration
      persistence:
        enabled: true
        # Name of existing PVC to use (overrides all other persistence values)
        existingClaim: ""
        # Size of the persistent volume
        size: 1Gi
        # Storage class
        storageClass: ""
        # Access mode
        accessMode: ReadWriteOnce
  
  # External OIDC Provider
  external:
    # Enable external OIDC provider
    # Set to true when using Auth0, Okta, Azure AD, Google, or any other external OIDC provider
    # NOTE: When enabled, this takes precedence over internal Keycloak
    enabled: false
    
    # OpenID Connect issuer URL (required when external.enabled: true)
    # This is the base URL of your OIDC provider
    # Examples:
    #   - Auth0: https://yourdomain.auth0.com
    #   - Okta: https://yourorg.okta.com/oauth2/default
    #   - Azure AD: https://login.microsoftonline.com/{tenant-id}/v2.0
    #   - Google: https://accounts.google.com
    #   - Keycloak: https://keycloak.example.com/realms/myrealm
    issuer: ""
    
    # OIDC client ID for OpenCloud (required when external.enabled: true)
    # This is the client/application ID registered with your OIDC provider
    clientId: ""
    
    # OIDC account management URL (optional)
    # URL where users can manage their profile, password, MFA, etc.
    # If not set, the account management link will not be displayed
    # Examples:
    #   - Keycloak: https://keycloak.example.com/realms/myrealm/account
    #   - Auth0: https://yourdomain.auth0.com/account
    accountUrl: ""
  
  # OpenCloud Built-in Identity Provider
  # Used when both keycloak and external are disabled
  internal:
    # Use existing secret for admin credentials (Note: secretKeyName must be adminPassword)
    # Only used when both identityProvider.keycloak.enabled and identityProvider.external.enabled are false
    existingSecret: ""
    
    # Admin password for OpenCloud's built-in IDP
    # Only used when both identityProvider.keycloak.enabled and identityProvider.external.enabled are false
    # This password is used for local admin authentication
    # ignored if identityProvider.internal.existingSecret is set
    # Leave empty to generate a random password
    adminPassword: ""
    
    # Create demo users in the local identity management system
    # Only used when both identityProvider.keycloak.enabled and identityProvider.external.enabled are false
    # When using Keycloak or external OIDC, users are managed by the IDP, not locally
    createDemoUsers: false


# =====================================================================
# STORAGE
# =====================================================================

# Storage configuration for OpenCloud
# Choose ONE storage backend:
#   1. internal (MinIO) - S3-compatible object storage deployed by this chart
#   2. external (S3/Ceph/MinIO) - Connect to external S3-compatible service
#   3. posixfs - Use filesystem-based storage (requires ReadWriteMany PVC for HA)
storage:
  # Internal MinIO deployment
  internal:
    # Enable internal MinIO instance
    # Suitable for development and small deployments
    enabled: true
    
    # MinIO image settings
    image:
      # MinIO image registry
      registry: docker.io
      # MinIO image repository
      repository: minio/minio
      # MinIO image tag
      tag: latest
      # Image pull policy
      pullPolicy: IfNotPresent
    
    # HTTPRoute configuration
    httpRoute:
      # Enable HTTPRoute for MinIO (default: false)
      enabled: false
    
    # Use existing secret for MinIO credentials (Note: secretKeyName must be rootUser and rootPassword)
    existingSecret: ""
    
    # MinIO Root user
    # ignored if storage.internal.existingSecret is set
    rootUser: opencloud

    # MinIO Root password
    # ignored if storage.internal.existingSecret is set
    # Leave empty to generate a random password
    rootPassword: ""
    
    # Bucket name
    bucketName: opencloud-bucket
    
    # Region (optional)
    region: "default"
    
    # Resources allocation
    # Resources allocation for MinIO
    resources: {}
      # Example:
      # requests:
      #   cpu: 100m
      #   memory: 256Mi
      # limits:
      #   cpu: 1000m
      #   memory: 2Gi
    
    # Persistence configuration
    persistence:
      enabled: true
      # Name of existing PVC to use (overrides all other persistence values)
      existingClaim: ""
      # Size of the persistent volume
      size: 5Gi
      # Storage class
      storageClass: ""
      # Access mode
      accessMode: ReadWriteOnce
  
  # External S3-compatible storage
  # Can be AWS S3, Ceph, external MinIO, or any S3-compatible service
  external:
    # Enable external S3 storage
    # When enabled, this takes precedence over internal MinIO
    enabled: false
    
    # S3 endpoint URL
    # Examples:
    #   - AWS S3: s3.amazonaws.com (or regional like s3.us-west-2.amazonaws.com)
    #   - MinIO: minio.example.com:9000
    #   - Ceph: ceph-rgw.example.com
    endpoint: ""
    
    # S3 region
    region: "default"
    
    # Use existing secret for S3 credentials (Note: secretKeyName must be accessKey and secretKey)
    existingSecret: ""
    
    # S3 access key
    # ignored if storage.external.existingSecret is set
    accessKey: ""

    # S3 secret key
    # ignored if storage.external.existingSecret is set
    secretKey: ""

    # S3 bucket name
    bucket: ""
    
    # Create bucket if it doesn't exist
    createBucket: true
  
  # POSIX filesystem storage
  # Use this when you want filesystem-based storage instead of S3
  # Requires ReadWriteMany PVC for high availability deployments
  posixfs:
    # Enable POSIX filesystem storage
    # When enabled, this takes precedence over S3 (internal or external)
    enabled: false
    
    # The type of the cache store
    # Supported values: 'memory', 'redis-sentinel', 'nats-js-kv' (default), 'noop'
    idCacheStore: nats-js-kv
    
    # Path of storage root directory
    # IMPORTANT: Path must be outside /var/lib/opencloud to avoid permission conflicts
    # See: https://docs.opencloud.eu/docs/admin/configuration/storage/storage-posix/
    rootPath: "/mnt/posixfs"
    
    # Persistence configuration
    persistence:
      # Enable persistence
      enabled: true
      # Name of existing PVC to use (overrides all other persistence values)
      existingClaim: ""
      # Size of the persistent volume for data
      size: 5Gi
      # Storage class
      storageClass: ""
      # Access mode (ReadWriteMany required for multiple replicas)
      accessMode: ReadWriteOnce

# =====================================================================
# COLLABORATION / OFFICE SUITE INTEGRATION
# =====================================================================
#
# Collaboration configuration for office document editing.
# The collaboration service provides WOPI (Web Application Open Platform Interface)
# support for integrating office suites like Collabora.
#
# Choose ONE provider:
#   1. collabora - Deploy Collabora Online with built-in collaboration service
#   2. external - Deploy only the collaboration service, connect to user-provided
#                 external office suite (e.g., Collabora, OnlyOffice). For OnlyOffice,
#                 deploy it separately with its required dependencies: PostgreSQL,
#                 RabbitMQ, and Redis.
#
# If none are enabled, office document editing will not be available.
# Only ONE provider should be enabled at a time.

collaboration:
  # -------------------------------------------------------------------------
  # Collabora Online
  # Deploys Collabora and the built-in collaboration service
  # -------------------------------------------------------------------------
  collabora:
    # Enable Collabora deployment and collaboration service
    enabled: false
    
    # App name for registration (used in app registry)
    appName: "CollaboraOnline"
    
    # Product name displayed to users
    product: "Collabora"
    
    # Collabora server URL
    # Leave empty to auto-configure from global.domain.collabora
    url: ""
    
    # Icon URL for Collabora
    # Leave empty to auto-configure
    icon: ""
    
    # Allow insecure connections (for self-signed certificates)
    insecure: false
    
    # WOPI source URL
    # For Collabora, this can use the internal service URL
    # Leave empty to auto-configure (defaults to internal service)
    wopiSrc: ""
    
    # Collabora container image settings
    image:
      registry: docker.io
      repository: collabora/code
      pullPolicy: IfNotPresent
      tag: 24.04.13.2.1
    
    # SSL settings for Collabora
    ssl:
      enabled: false
      verification: false
    
    # Use existing secret for collabora credentials
    # (Note: secretKeyName must be username and password)
    existingSecret: ""
    
    # Admin credentials for Collabora
    admin:
      # ignored if existingSecret is set
      username: admin
      # ignored if existingSecret is set
      # Leave empty to generate a random password
      password: ""
    
    # Resources allocation for Collabora
    # Resources allocation for Collabora
    resources: {}
      # Example:
      # requests:
      #   cpu: 100m
      #   memory: 256Mi
      # limits:
      #   cpu: 1
      #   memory: 1Gi
    
    # Additional deployment annotations
    deploymentAnnotations: {}
      # Example for Stakater Reloader (requires reloader to be installed):
      # reloader.stakater.com/auto: "true"
    
    # Additional deployment labels
    deploymentLabels: {}
    
    # Additional pod annotations
    podAnnotations: {}
    
    # Additional pod labels
    podLabels: {}
    
    # Ingress configuration for Collabora
    ingress:
      # Enable ingress for Collabora
      enabled: false
      # Ingress class name (inherits from global ingress.ingressClassName if empty)
      ingressClassName: ""
      # Annotations preset (inherits from global ingress.annotationsPreset if empty)
      annotationsPreset: ""
      # Custom annotations (merged with global ingress.annotations)
      annotations: {}
      # TLS configuration
      tls:
        # Enable TLS (inherits from global ingress.tls.enabled if not set)
        enabled: false
        # TLS secret name (inherits from global ingress.tls.secretName if empty)
        secretName: ""
  

  # -------------------------------------------------------------------------
  # External collaboration provider
  # Deploys only the collaboration service, connects to user-provided
  # external office suite (e.g., Collabora, OnlyOffice)
  # -------------------------------------------------------------------------
  external:
    # Enable external collaboration provider
    enabled: false
    
    # App name for registration (required when external.enabled: true)
    appName: ""
    
    # Product name displayed to users (required when external.enabled: true)
    product: ""
    
    # External office suite URL (required when external.enabled: true)
    url: ""
    
    # Icon URL
    icon: ""
    
    # Allow insecure connections
    insecure: false
    
    # WOPI source URL (required for external provider)
    wopiSrc: ""
  
  # -------------------------------------------------------------------------
  # Shared settings for built-in collaboration service
  # These apply when using collabora or external
  # -------------------------------------------------------------------------
  service:
    # gRPC server address
    grpcAddr: "0.0.0.0:9301"
    # HTTP server address
    httpAddr: "0.0.0.0:9300"
  
  # Ingress configuration for collaboration service (WOPI endpoint)
  ingress:
    # Enable ingress for collaboration service
    enabled: false
    # Ingress class name (inherits from global ingress.ingressClassName if empty)
    ingressClassName: ""
    # Annotations preset (inherits from global ingress.annotationsPreset if empty)
    annotationsPreset: ""
    # Custom annotations (merged with global ingress.annotations)
    annotations: {}
    # TLS configuration
    tls:
      # Enable TLS (inherits from global ingress.tls.enabled if not set)
      enabled: false
      # TLS secret name (inherits from global ingress.tls.secretName if empty)
      secretName: ""

# =====================================================================
# EXTENSIONS
# =====================================================================

# Tika settings for full-text search
tika:
  # Enable Tika
  enabled: false
  # Tika image settings
  image:
    # Tika image registry
    registry: docker.io
    # Tika image repository
    repository: apache/tika
    # Tika image tag
    tag: "2.9.2.1-full"
    # Image pull policy
    pullPolicy: IfNotPresent
  # Resources allocation
  # Resources allocation for Tika
  resources: {}
    # Example:
    # requests:
    #   cpu: 100m
    #   memory: 1Gi
    # limits:
    #   cpu: 1000m
    #   memory: 3Gi

# Web Extensions settings
webExtensions:
  # Enable web extensions
  enabled: false
  # Common image settings for all extensions
  image:
    # Registry for web extensions
    registry: docker.io
    # Repository for web extensions
    repository: opencloudeu/web-extensions
    # Image pull policy
    pullPolicy: IfNotPresent
  # List of extensions to install
  extensions:
    # Draw.io extension
    drawio:
      enabled: true
      tag: draw-io-1.0.0
    # External Sites extension
    externalsites:
      enabled: true
      tag: external-sites-1.0.0
    # Importer extension
    importer:
      enabled: true
      tag: importer-1.0.0
    # JSON Viewer extension
    jsonviewer:
      enabled: true
      tag: json-viewer-1.0.0
    # Progress Bars extension
    progressbars:
      enabled: true
      tag: progress-bars-1.0.0
    # Unzip extension
    unzip:
      enabled: true
      tag: unzip-1.0.0

# =====================================================================
# OPENCLOUD CORE
# =====================================================================

# OpenCloud core settings
opencloud:
  # Enable OpenCloud
  enabled: true
  
  # Number of replicas (Note: When using multiple replicas, persistence should be disabled
  # or use a storage class that supports ReadWriteMany access mode)
  replicas: 1
  
  # Image settings for OpenCloud
  image:
    # OpenCloud image registry
    registry: docker.io
    # OpenCloud image repository
    repository: opencloudeu/opencloud-rolling
    # OpenCloud image tag (defaults to Chart.appVersion if empty)
    tag: ""
    # Image pull policy
    pullPolicy: IfNotPresent
    # Image pull secrets for private registries
    # Reference existing secrets by name
    pullSecrets: []
    # Example:
    # - name: my-registry-secret
  
  # Service Account configuration
  serviceAccount:
    # Specifies whether a service account should be created
    create: true
    # Annotations to add to the service account
    annotations: {}
    # The name of the service account to use.
    # If not set and create is true, a name is generated using the fullname template
    name: ""
  
  # Additional services to start
  additionalServices: []
  # Services to exclude from starting
  # Note: Services are automatically excluded based on configuration:
  #   - 'idp' is excluded when using any identity provider (internal Keycloak or external OIDC)
  #   - 'nats' is excluded when using external NATS (nats.external.enabled: true)
  excludeServices: []
  
  # Application configuration
  # Configuration values for OpenCloud services
  # The chart handles the implementation details (environment variables vs config files)
  config:
    # Logging configuration
    log:
      # Log level (debug, info, warn, error)
      level: info
      # Enable colored log output
      color: false
      # Enable pretty-printed JSON logs
      pretty: false
    
    # Insecure mode (for self-signed certificates)
    insecure: true
    
    # JWT Secret configuration
    jwtSecret:
      # Use existing secret for JWT secret (Note: secretKeyName must be jwtSecret)
      existingSecret: ""
      
      # JWT Secret value for OpenCloud
      # ignored if opencloud.config.jwtSecret.existingSecret is set
      # Leave empty to generate a random secret
      value: ""
    
    # Graph service configuration (roles and user management)
    graph:
      # Available roles - list of enabled role UUIDs
      # Leave empty (default) to use OpenCloud's built-in default roles.
      # The built-in defaults match the enabled roles in docs/unified-roles.txt
      # Only specify this if you need a custom role configuration.
      # For full role details see: docs/unified-roles.txt
      availableRoles: []
        # Example - custom role configuration:
        # - "b1e2218d-eef8-4d4c-b82d-0f1a1b48f3b5"  # Viewer: View and download
        # - "a8d5fe5e-96e3-418d-825b-534dbdf22b99"  # SpaceViewer: View and download (space-level)
        # - "fb6c3e19-e378-47e5-b277-9732f9de6e21"  # Editor: View, download, upload, edit, add and delete
        # - "58c63c02-1d89-4572-916a-870abc5a1b7d"  # SpaceEditor: View, download, upload, edit, add, delete including history
        # - "2d00ce52-1fc2-4dbc-8b95-a73b73395f5a"  # FileEditor: View, download and edit (files only)
        # - "1c996275-f1c9-4e71-abdf-a42f6495e960"  # EditorLite: View, download and upload (no edit/delete)
        # - "312c0871-5ef7-4b3a-85b6-0e4074c64049"  # SpaceManager: Full permissions including member management
        # - "aa97fe03-7980-45ac-9e50-b325749fd7e6"  # SecureViewer: View documents/images/PDFs with watermarks (no download)
        # 
        # Disabled by default (can be enabled if needed):
        # - "d5041006-ebb3-4b4a-b6a4-7c180ecfb17d"  # ViewerListGrants: Viewer + show all invited people
        # - "e8ea8b21-abd4-45d2-b893-8d1546378e9e"  # EditorListGrants: Editor + show all invited people
        # - "3284f2d5-0070-4ad8-ac40-c247f7c1fb27"  # SpaceEditorWithoutVersions: SpaceEditor without version access
        # - "c1235aea-d106-42db-8458-7d5610fb0a67"  # FileEditorListGrants: FileEditor + show all invited people
        # - "63e64e19-8d43-42ec-a738-2b6af2610efa"  # Deny: Deny all access
      # Assign default user role automatically
      assignDefaultUserRole: false
      # Username matching strategy (none, email, username)
      usernameMatch: "none"
    
    # Proxy service configuration
    proxy:
      # Use TLS between proxy and OpenCloud services
      tls: false
      # Enable basic authentication
      # Note: Automatically disabled when OIDC is enabled
      enableBasicAuth: false
      # Auto-provision user accounts from OIDC
      autoprovisionAccounts: true
      # Role assignment driver (oidc, default)
      roleAssignmentDriver: "oidc"
      
      # OIDC configuration (used when Keycloak or external OIDC is enabled)
      oidc:
        # Rewrite OIDC well-known endpoint
        rewriteWellknown: true
        # OIDC claim to use for user identification
        userOidcClaim: "preferred_username"
        # CS3 claim to use for user identification
        userCs3Claim: "username"
        # OIDC claim containing user roles
        roleAssignmentClaim: "roles"
        # Access token verification method (jwt, none)
        accessTokenVerifyMethod: "jwt"
      
      # Role mappings (OIDC claim values â†’ OpenCloud roles)
      # This is used for advanced role assignment scenarios
      # Leave empty to use default role mapping based on roleAssignmentClaim
      roleMappings: []
        # Example:
        # - roleName: admin
        #   claimValue: opencloud-admin
        # - roleName: spaceadmin
        #   claimValue: opencloud-spaceadmin
        # - roleName: user
        #   claimValue: opencloud-user
        # - roleName: guest
        #   claimValue: opencloud-guest
    
    # Frontend configuration
    frontend:
      # Read-only user attributes (comma-separated)
      # These attributes are managed by the IDP and cannot be changed in OpenCloud
      readonlyUserAttributes: "user.onPremisesSamAccountName,user.displayName,user.mail,user.passwordProfile,user.accountEnabled,user.appRoleAssignments"
    
    # Web UI configuration
    web:
      # OIDC scope to request
      oidcScope: "openid profile email groups roles"
      # Web UI theme
      theme: "owncloud"
    
    # Sharing configuration
    sharing:
      # Require password for public shares
      publicShareMustHavePassword: false
    
    # Password policy configuration
    passwordPolicy:
      # Filename of banned passwords list (relative to /etc/opencloud)
      bannedPasswordsFile: "banned-password-list.txt"
      # Banned password list configuration
      # Format: Multi-line string (not YAML array)
      # Use the |- syntax to preserve line breaks
      # Add one password per line - do not use YAML list syntax (no dashes)
      # Example:
      #   bannedPasswordList: |-
      #     password1
      #     password2
      #     password3
      # For very long lists override the file 'files/opencloud/banned-password-list.txt'
      bannedPasswordList: |-
    
    # Search configuration
    search:
      # Extractor type (tika, basic)
      # Note: If set to "tika" but tika.enabled is false, will automatically fall back to "basic"
      # This prevents service startup failures when Tika is not available
      extractorType: "tika"
    
    # gRPC performance settings
    grpc:
      # Maximum received message size in bytes
      maxReceivedMessageSize: "102400000"
    
    # Admin user configuration
    admin:
      # Admin user ID (leave empty for default)
      userId: ""
    
    # App registry configuration
    # Leave empty to use default from files/opencloud/app-registry.yaml
    appRegistry: {}
    
    # CSP (Content Security Policy) configuration
    # Allows extending default CSP directives with additional sources.
    # The chart automatically includes required domains (Collabora, identity provider).
    # Add custom sources to specific directives without overriding the entire CSP.
    # All values should be properly formatted CSP source expressions (e.g., 'https://example.com', '''self''').
    # Example:
    csp: {}
      # # Add custom domains to connect-src (for API calls, WebSocket connections)
      # connectSrc:
      #   - 'https://api.external-service.com'
      #   - 'wss://websocket.external-service.com'
      # 
      # # Add custom domains to frame-src (for embedding iframes)
      # frameSrc:
      #   - 'https://embed.external-service.com'
      # 
      # # Add custom image sources to img-src
      # imgSrc:
      #   - 'https://cdn.external-service.com'
      # 
      # # Other available directives (all optional):
      # # childSrc, defaultSrc, fontSrc, frameAncestors, manifestSrc,
      # # mediaSrc, objectSrc, scriptSrc, styleSrc, workerSrc
  
  # Raw environment variable overrides (advanced use)
  # These will be added to the container env section after all generated env vars
  # Use this for any OpenCloud env vars not covered by config.env above
  extraEnv: []
  # Example:
  # - name: CUSTOM_ENV_VAR
  #   value: "custom-value"
  
  # Environment variables from ConfigMaps or Secrets
  extraEnvFrom: []
  # Example:
  # - configMapRef:
  #     name: my-configmap
  # - secretRef:
  #     name: my-secret
  # Resources allocation
  # Resources allocation for OpenCloud
  resources: {}
    # Example:
    # requests:
    #   cpu: 128m
    #   memory: 128Mi
    # limits:
    #   memory: 20Gi
  
  # Pod scheduling configuration
  # Node selector for pod assignment
  nodeSelector: {}
  # Example:
  # disktype: ssd
  
  # Tolerations for pod assignment
  tolerations: []
  # Example:
  # - key: "key1"
  #   operator: "Equal"
  #   value: "value1"
  #   effect: "NoSchedule"
  
  # Affinity rules for pod assignment
  affinity: {}
  # Example:
  # podAntiAffinity:
  #   preferredDuringSchedulingIgnoredDuringExecution:
  #   - weight: 100
  #     podAffinityTerm:
  #       labelSelector:
  #         matchExpressions:
  #         - key: app.kubernetes.io/name
  #           operator: In
  #           values:
  #           - opencloud
  #       topologyKey: kubernetes.io/hostname
  
  # Additional deployment annotations
  deploymentAnnotations: {}
    # Example for Stakater Reloader (requires reloader to be installed):
    # reloader.stakater.com/auto: "true"
  
  # Additional deployment labels
  deploymentLabels: {}
  
  # Additional pod annotations
  podAnnotations: {}
  
  # Additional pod labels
  podLabels: {}
  
  # Termination grace period in seconds
  terminationGracePeriodSeconds: 30
  
  # DNS policy for the pod
  dnsPolicy: ClusterFirst
  
  # Init container resource configuration
  # Resources allocation for init containers
  initResources: {}
    # Example:
    # requests:
    #   cpu: 10m
    #   memory: 32Mi
    # limits:
    #   cpu: 100m
    #   memory: 128Mi
  
  # Ingress configuration for OpenCloud
  ingress:
    # Enable ingress for OpenCloud
    enabled: false
    # Ingress class name (inherits from global ingress.ingressClassName if empty)
    ingressClassName: ""
    # Annotations preset (inherits from global ingress.annotationsPreset if empty)
    annotationsPreset: ""
    # Custom annotations (merged with global ingress.annotations)
    annotations: {}
    # TLS configuration
    tls:
      # Enable TLS (inherits from global ingress.tls.enabled if not set)
      enabled: false
      # TLS secret name (inherits from global ingress.tls.secretName if empty)
      secretName: ""
  
  # Persistence configuration
  persistence:
    config:
      # Enable persistence
      enabled: true
      # Name of existing PVC to use (overrides all other persistence values)
      existingClaim: ""
      # Size of the persistent volume for config
      size: 1Gi
      # Storage class
      storageClass: ""
      # Access mode (ReadWriteOnce or ReadWriteMany for multiple replicas)
      accessMode: ReadWriteOnce
    data:
      # Enable persistence
      enabled: true
      # Name of existing PVC to use (overrides all other persistence values)
      existingClaim: ""
      # Size of the persistent volume for data
      size: 5Gi
      # Storage class
      storageClass: ""
      # Access mode (ReadWriteOnce or ReadWriteMany for multiple replicas)
      accessMode: ReadWriteOnce

  # =====================================================================
  # NATS (Messaging System)
  # =====================================================================
  
  # NATS configuration for messaging, caching, and service registry
  # Choose ONE: either internal (embedded) OR external NATS
  nats:
    # Internal embedded NATS (default)
    # Suitable for development and small deployments
    internal:
      # Enable internal embedded NATS instance
      enabled: true
      # Internal NATS listens on 0.0.0.0:9233 (localhost only)
    
    # External NATS cluster
    # Recommended for production, high availability, and larger deployments (>100 users)
    external:
      # Enable external NATS cluster
      # When enabled, this takes precedence over internal NATS
      enabled: false

      # NATS server endpoint
      endpoint: nats.opencloud-nats.svc.cluster.local:4222

      # Cluster name for the NATS cluster
      cluster: opencloud-cluster

      # TLS configuration for NATS connection
      tls:
        # Enable TLS encrypted communication with NATS
        # Recommended for production
        enabled: false
        
        # Whether the NATS server certificate is trusted
        # Set to false if using self-signed certificates
        certTrusted: true

        # Disable SSL certificate verification (insecure)
        # Not recommended for production
        insecure: false

        # Secret name containing the CA certificate for NATS
        # Only used when certTrusted is false
        # Secret must contain key 'ca.crt' with the root CA certificate
        caSecretName: opencloud-nats-ca

  # =====================================================================
  # EMAIL (SMTP)
  # =====================================================================
  
  # SMTP settings for email notifications
  smtp:
    # Enable SMTP
    enabled: false
    # SMTP host
    host: ""
    # SMTP port
    port: "587"
    # SMTP sender
    sender: ""
    
    # Use existing secret for opencloud smtp credentials (Note: secretKeyName must be smtpUser and smtpPassword)
    existingSecret: ""
    
    # SMTP username
    # ignored if opencloud.smtp.existingSecret is set
    username: ""

    # SMTP password
    # ignored if opencloud.smtp.existingSecret is set
    password: ""

    # SMTP insecure (allow self-signed certificates)
    insecure: "false"
    # SMTP authentication method
    authentication: "plain"
    # SMTP encryption method
    encryption: "starttls"

# =====================================================================
# GATEWAY-API HTTPRoute
# =====================================================================

# Requires Gateway API resources and suitable controller installed within the cluster
# (see: https://gateway-api.sigs.k8s.io/guides/)
httpRoute:
  # Enable HTTPRoute resources (set to true to create Gateway API routes)
  enabled: false

  # Gateway configuration
  gateway:
    # Create the gateway
    create: false
    # HTTPS Port to listen to (k3s traefik defaults to 8443)
    port: 443
    # Gateway name
    name: opencloud-gateway
    # Gateway class (defaults to "cilium")
    className: cilium
    # Gateway namespace (defaults to Release.Namespace)
    namespace: ""
    # Gateway section name (applies to all routes). If set to a non-empty value, this overrides the default component-specific section names (e.g., opencloud-https, collabora-https) for all routes. If left empty, the defaults are used.
    sectionName: ""
    # Gateway annotations
    annotations:
    # Gateway annotations
    infrastructure:
      annotations: {}

# =====================================================================
# UTILITY IMAGES
# =====================================================================

# Busybox image settings (used for init containers)
busybox:
  image:
    # Busybox image registry
    registry: docker.io
    # Busybox image repository
    repository: library/busybox
    # Busybox image tag
    tag: "1.36"
    # Image pull policy
    pullPolicy: IfNotPresent
